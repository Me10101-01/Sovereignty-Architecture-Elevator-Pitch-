# Antibody Department - Digital Immune System Agents
# Deployment configurations for Blue Team defensive agents
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: threat-detector
  namespace: antibody-dept
  labels:
    app: threat-detector
    team: blue-team
    component: antibody
spec:
  replicas: 2
  selector:
    matchLabels:
      app: threat-detector
  template:
    metadata:
      labels:
        app: threat-detector
        team: blue-team
        component: antibody
    spec:
      serviceAccountName: antibody-agent
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        fsGroup: 1000
        seccompProfile:
          type: RuntimeDefault
      containers:
      - name: detector
        image: busybox:1.36
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "Threat Detector Agent Starting..."
            echo "Monitoring for security threats..."
            while true; do
              echo "[$(date)] Scanning for threats..."
              sleep 30
            done
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
        env:
        - name: FALCO_ENDPOINT
          value: "falco.monitoring:9090"
        - name: ALERT_WEBHOOK
          value: "http://alertmanager.monitoring:9093"
        - name: LOG_LEVEL
          value: "info"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: policy-enforcer
  namespace: antibody-dept
  labels:
    app: policy-enforcer
    team: blue-team
    component: antibody
spec:
  replicas: 2
  selector:
    matchLabels:
      app: policy-enforcer
  template:
    metadata:
      labels:
        app: policy-enforcer
        team: blue-team
        component: antibody
    spec:
      serviceAccountName: antibody-agent
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        fsGroup: 1000
        seccompProfile:
          type: RuntimeDefault
      containers:
      - name: enforcer
        image: busybox:1.36
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "Policy Enforcer Agent Starting..."
            echo "Enforcing security policies..."
            while true; do
              echo "[$(date)] Checking policy compliance..."
              sleep 30
            done
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
        env:
        - name: POLICY_SOURCE
          value: "/config/policies"
        - name: ENFORCE_MODE
          value: "strict"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: state-healer
  namespace: antibody-dept
  labels:
    app: state-healer
    team: blue-team
    component: antibody
spec:
  replicas: 1
  selector:
    matchLabels:
      app: state-healer
  template:
    metadata:
      labels:
        app: state-healer
        team: blue-team
        component: antibody
    spec:
      serviceAccountName: antibody-agent
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        fsGroup: 1000
        seccompProfile:
          type: RuntimeDefault
      containers:
      - name: healer
        image: busybox:1.36
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "State Healer Agent Starting..."
            echo "Monitoring for state drift..."
            while true; do
              echo "[$(date)] Checking state integrity..."
              sleep 60
            done
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
          limits:
            memory: "128Mi"
            cpu: "200m"
        env:
        - name: STATE_SOURCE
          value: "configmap/state-sync-config"
        - name: AUTO_REMEDIATE
          value: "true"
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: audit-analyzer
  namespace: antibody-dept
  labels:
    app: audit-analyzer
    team: blue-team
    component: antibody
spec:
  replicas: 1
  selector:
    matchLabels:
      app: audit-analyzer
  template:
    metadata:
      labels:
        app: audit-analyzer
        team: blue-team
        component: antibody
    spec:
      serviceAccountName: antibody-agent
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        fsGroup: 1000
        seccompProfile:
          type: RuntimeDefault
      containers:
      - name: analyzer
        image: busybox:1.36
        command: ["/bin/sh", "-c"]
        args:
          - |
            echo "Audit Analyzer Agent Starting..."
            echo "Analyzing audit logs..."
            while true; do
              echo "[$(date)] Processing audit logs..."
              sleep 3600
            done
        securityContext:
          allowPrivilegeEscalation: false
          readOnlyRootFilesystem: true
          capabilities:
            drop:
              - ALL
        resources:
          requests:
            memory: "128Mi"
            cpu: "200m"
          limits:
            memory: "256Mi"
            cpu: "400m"
        env:
        - name: LOG_SOURCE
          value: "loki.monitoring:3100"
        - name: REPORT_INTERVAL
          value: "1h"
---
apiVersion: v1
kind: Service
metadata:
  name: antibody-agents
  namespace: antibody-dept
  labels:
    app: antibody-agents
    team: blue-team
spec:
  selector:
    component: antibody
  ports:
  - name: metrics
    port: 9090
    targetPort: 9090
