name: SovereignPRManager

on:
  # Run on new PRs and PR updates
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
  
  # Allow manual trigger
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Dry run (no actual merges)'
        required: false
        default: 'true'
        type: boolean
      pr_number:
        description: 'Specific PR number to process (optional)'
        required: false
        type: string

jobs:
  review-and-synthesize:
    name: Automated PR Review
    runs-on: ubuntu-latest
    
    # Only run on PRs, not the main branch
    if: github.event_name == 'pull_request' || github.event_name == 'workflow_dispatch'
    
    permissions:
      contents: read
      pull-requests: write
      
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          cache-dependency-path: 'sovereign_pr_manager/requirements.txt'
          
      - name: Install Dependencies
        run: |
          pip install -r sovereign_pr_manager/requirements.txt
          
      - name: Run PR Review
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DRY_RUN: ${{ github.event.inputs.dry_run || 'true' }}
          GITHUB_REPO: ${{ github.repository }}
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ¤– SovereignPRManager: Automated Review"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          if [ -n "${{ github.event.inputs.pr_number }}" ]; then
            python -m sovereign_pr_manager --pr ${{ github.event.inputs.pr_number }} --dry-run
          elif [ "${{ github.event_name }}" == "pull_request" ]; then
            python -m sovereign_pr_manager --pr ${{ github.event.pull_request.number }} --dry-run
          else
            python -m sovereign_pr_manager --dry-run
          fi
          
      - name: Summary
        if: always()
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Review Complete"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "Note: Auto-merge is disabled by default."
          echo "Set DRY_RUN=false to enable auto-merging."
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
